## Kết hợp Ceph Mimic với Owncloud thông qua RADOS gateway, S3 interface

## Sơ đồ : 

3 node : 
- node1 : MON 
- node2 : OSD
- node3 : OSD + RGW deamon
- node4 : ceph-depoy + owncloud

## Triển khai 

1. Triển khai Ceph 

2. Cài đặt Owncloud 

Bước 1 : Cài đặt repo EPEL và REMO trong centos 7

```
yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm -y

yum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm -y
```

Bước 2 : Cài đặt yum-utils

``yum install yum-utils -y``

Sử dụng yum-config-manager ( có được sau khi cài yum-utils ) lựa chọn phiên bản Remi php 7.2

``yum-config-manager --enable remi-php72``

Bước 3 : Cài đặt php 7 và các package hỗ trợ

``yum install php php-mbstring php-pdo php-json php-pear php-mbstring php-dom php-xml php-mcrypt php-cli php-gd php-curl php-mysql php-ldap php-zip php-fileinfo php-intl -y``

### Cài đặt và thiết lập MariaDB

Bước 1 : Cài đặt MariaDB

``yum install mariadb-server``

Start và enable mariadb : 

``systemctl start mariadb && systemctl enable mariadb``

Bước 2 : Thiết lập MariaDB

``mysql_secure_installation``

Bước 3 : Cấu hình MariaDB

Truy cập Mariadb :

``mysql -u root -p``

Tại màn hình CMD : 

```
CREATE DATABASE owncloud;
CREATE USER 'oc_user'@'localhost' IDENTIFIED BY 'NHẬP_PASS_TẬI_ĐÂY';
GRANT ALL PRIVILEGES ON owncloud.* TO 'oc_user'@'localhost';
FLUSH PRIVILEGES;
```

### Cài đặt Owncloud

Bước 1 : Thiết lập gói 

``rpm --import https://download.owncloud.org/download/repositories/10.0/CentOS_7/repodata/repomd.xml.key``

``curl https://download.owncloud.org/download/repositories/10.0/CentOS_7/ce:10.0.repo | tee /etc/yum.repos.d/owncloud_CE:10.0.repo`` ( nếu không được ta vào trang https://download.own.... vào copy nội dung vào /etc/yum.repos.d/owncloud_CE:10.0.repo )

Bước 2 : Cài đặt Owncloud : 

``yum install owncloud``

### Khởi động apache, cấu hình SElinux và Firewalld

Bước 1 : Tắt SElinux

``sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config``

Bước 2 : Chạy apache service

``systemctl start httpd && systemctl enable httpd``

Bước 3 : Tắt Firewalld

``systemctl stop firewalld && systemctl disable firewalld``

### Thiết lập Owncloud

Truy cập "http://192.168.20.133/owncloud/" ( địa chỉ IP của máy cài owncloud )

<img src="https://github.com/VuVinh00/Images/blob/master/oc-lab-install-1.jpg">

### Nguồn tham khảo : 

https://github.com/lacoski/khoa-luan/blob/master/Lab/ceph-luminous-owncloud.md
